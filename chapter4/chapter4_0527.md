# はじめに
本稿では，教科書「コンピュータネットワーク」より，第4章4.3節4.3.1項から4.3.4項までの内容をまとめたものである．
これまでに述べたチャネル割当プロトコルが，実際のシステムへどのように適用されているかについて述べていく．
とくに本稿では世界でもっとも広く普及しているコンピュータネットワークであろう，イーサネットについて取り扱う．

# イーサネット
イーサネットには **クラシック・イーサネット（classic Ethernet）** と **スイッチ式イーサネット（switched Ethernet）** の2種類がある．
クラシック・イーサネットはこの章で触れる技術を用いて，マルチ・アクセスにより生じる問題を解決している．
スイッチ式イーサネットはコンピューター間をつなぐために「スイッチ」と呼ばれるデバイスを用いる．
これらの両方が「イーサネット」と呼ばれるが，両者は大きく異なっている．
クラシック・イーサネットはイーサネットのもともとの形態である．
スイッチ式イーサネットはイーサネットの現在の形である．
ここからは，イーサネットの歴史的な変遷をそれらがどのように開発されたと共に時系列に沿って論じていく．

## クラシック・イーサネットの物理層
イーサネットの歴史はALOHAの歴史と同時に始まった．
Bob Metcalfという学生がM.I.Tで学士号を取得し，博士号のコースをハーバード大学で歩み始めたときである．
研究を進める中で，彼はAbramsonの研究に出会った．
その後，彼はハーバードを卒業しXerox PARC（Palo Alto研究所）で働き始めた．
そこで彼が目にしたものは，後に「パーソナル・コンピューター」と呼ばれるもの，Xerox Altoであった．
ただし，個々の機械は互いに独立していた．
彼は，Abramsonの研究に関する知識を用いて同僚のDavit Boggsとともに，はじめてのLANを設計・実装した．
伝送媒体として同軸ケーブルが用いられ，速度は3Mbpsであった．
彼らはかつて電磁放射を伝えると考えられていた発行性エーテルにちなんで，このシステムを **イーサネット（Ethernet）** と呼んだ．  
Xeroxのイーサネットが大成功したので，DECとIntel，そしてXeroxは **DIX規格（DIX Standard）** と呼ばれる10Mbpsの規格を制定した．
このDIX規格に小さな変更を加えることで，1983年にIEEE802.3という規格が作られた．
Xeroxは，すでにパーソナル・コンピューターのような独創的発明をしていたにもかかわらず，この規格の商業化に失敗した．
Xeroxが規格の標準化以外にほとんど興味を示さなかったため，Metcalfeはイーサネット・アダプターを販売する会社，3Comを設立し，アダプターを何百万個も販売した．  
クラシック・イーサネットでは，一本の長いケーブルが建物中を這い回り，すべてのコンピューターが接続された．
このアーキテクチャを図4-13(p274)に示す．

* シック・イーサネット（thick Ethernet）
  * ケーブルは黄色い庭のホースに似ている（規格として色が指定されてはいないが，黄色が推奨されている）
  * 2.5mごとにコンピューターを接続する場所を示す印が示されている
  * 1つのセグメントの長さは500m以内
  * 接続台数は100台以内
* シン・イーサネット（thin Ethernet）
  * より曲げやすく，工業規格であるBNCコネクタを用いる
  * 安価かつ導入が安易である
  * 1つのセグメントの長さは185m以内
  * 接続台数は30台以内

どちらのイーサネットを用いても信号伝搬距離からセグメントあたりの長さの上限が決まっているため，より大規模なネットワークを構築するためには，複数のケーブルを **リピーター（repeater）** と呼ばれる装置で接続する必要がある．
リピーターは，信号を受信・増幅し，その信号を機器の両方向に返す物理層のデバイスである．
ソフトウェアから見ると，リピーターで接続した複数のケーブルは，一本のケーブルと同じように見える．  
これらのケーブルにより，情報はマンチェスタ符号化を用いて送信される（マンチェスタ符号化については2.5節を参照）．
イーサネットは複数のケーブルで構成することができるが，どのトランシーバー間も2.5km以上離すことはできないほか，2つのトランシーバー間に4つ以上のリピータを挟むこともできない．
これらの制限はMACプロトコルを正常に動作させるためのものである．

## クラシック・イーサネットのMAC副層プロトコル
送信フレームのフォーマットを図4-14(p274)に示す．

* プリアンブル（8バイト）  
  1〜7バイトはいずれも`10101010`というビットパターンを持つ．
  最終バイトだけは最後の2ビットが`11`となる．
  この最終バイトはIEEE802.3でフレーム開始区切り（Start of Frame delimiter）と呼ばれている．
  このパターンを符号化すると長さ\SI{6.4}{\micro s}の\SI{10}{MHz}の矩形波となり，これによって送受信者間のクロックを同期させる．また，最後の2ビットによって残りのフレームを送信することを受信者に伝える．
* あて先アドレス，送信元アドレス（6バイト）  
  あて先アドレスで最初に送られるアドレスは，通常のアドレスの場合0，グループ・アドレスの場合1である．
  グループ・アドレスにより，1つの場所から送られたものを複数の端末で受信できるようになる．
  フレームがグループ・アドレス宛てに送られると，グループ内のすべての局がそのフレームを受信する．
  * マルチキャスト（multicasting)  
    グループ・アドレスに送信することをマルチキャストという．
    ブロードキャストに比べて選択的であるが，各局とグループの対応の管理が必要となる．
  * ブロードキャスト（bloadcasting）  
    特別なアドレスとして，あて先アドレスの全ビットがすべて1のものはブロードキャスト用として予約されている．
    このフレームは，ネットワーク上のすべての局に送信される．
    局同士を区別する必要がないため，グループ分けの管理も不要である．
  
  局が持つ送信元アドレスは，IEEEによってどの局間でも重複が起こらないように割り振られており，全世界で一意である．
  アドレスの最初の3バイトは **OUI(Organizationally Unique Identifier)** に用いられている．
  この値はIEEEにより割り振られ，メーカーを示す．
  メーカーは残りの3バイトを自ら割り振り，NICに登録する．
* タイプ，長さ（2バイト）  
  フレームがイーサネットかIEEE802.3であるかに依存して内容が異なる．
  * イーサネット : タイプ・フィールド  
    受信者にこのフレームをどのプロセスに渡すべきかを明示する．
    しかし，これではデータの中身を見なければフレームの長さがわからないため，階層化の決まりに反してしまう．
  * IEEE802.3 : 長さフィールド  
    フレーム長を保持している．
    受信者にとってフレームをどう処理すべきか判断する方法は， **LLC（Logical Link Control : 論理リンク制御）** プロトコル用の別のヘッダーをデータ内に追加することで提供される．
* データ（0-1500バイト），パッド（0-46バイト）  
  データは1500バイト以下である．
  これは，イーサネット標準が制定されたとき，トランシーバーがフレームを格納するのに十分なRAMを必要とし，かつ，当時RAMは高価であったことに基づいてある程度恣意的に選ばれたものである．
  最大フレーム長に加え，最小フレーム長も存在する．
  イーサネットでは，正しいフレームとそうでないフレームの区別を容易にするため，正しいフレームはあて先アドレスからチェックサムまで少なくとも64バイトの長さを持つ必要があると定めている．
  よって，フレームのデータ部分が46バイトより短い場合，フレームの長さを広げるためにパッドフィールドが用いられる．
  * 最小フレーム長
    * 衝突を検知したとき，送信中のフレームの送信は打ち切られるため，バラバラとなったビットとフレームのかけらがいくつもケーブル上に存在してしまう．
      もしデータが極端に短いフレームが送信されると，これらと見分けがつきにくい．
    * 送信した最初のビットがケーブルの終端へ到着する前にフレームの送信が終了してしまうと，送信側が衝突を検知する前に送信が正常に終了したと誤認する恐れがある．
      そのため，衝突を検知したときにフレームを送信しておくためには，送信時間を終端までの遅延時間の2倍以上とする必要がある．
  * パッド  
    フレームが終端に到着する遅延時間を$\tau$とする．
    上記より，すべてのフレームは送信に$2\tau$以上の時間をかけなければならない．
    \SI{2.5}{km}の最長距離と4つのリピータを持つ約10Mビット/秒のLANでは，リピータの遅延時間を含めラウンド・トリップ時間は最悪の場合で約\SI{50}{\micro s}と算出される．
    1ビットの転送に\SI{100}{\nano s}かかるため，最小のフレーム長は500ビットとなる．
    いくらかの余裕を付加して，512ビット（64バイト）に丸められる．
    データフィールドまでのフィールドの長さを合計すると，22バイトであるため，差し引き46バイト必要である．
    よって，データフィールドが46バイト未満であるとき，不足分をパッドフィールドで埋め合わせる．
  * チェックサム（4バイト）  
    フレームのビットが正しく受信されたか判断するための誤り検出コードとして用いられている．
    誤りが検出された場合，そのフレームを破棄する．
    32ビットCRCであり，生成多項式を用いて定義されている（詳細は3.2節を参照）．

### べき乗バックオフを用いたCSMA/CD
クラシック・イーサネットは1ー永続CSMAアルゴリズムを用いている．
送信すべきフレームを持っている局が媒体を監視し，媒体が使用されなくなるとすぐにフレームを送信する．
局は送信時にチャネル上の衝突を監視する．
衝突が発生した場合，局は短いジャム信号を発して送信を中止し，ランダムな時間間隔のあとに再送信を行う．
衝突が発生したとき，ランダムな時間間隔をどのように決定するかを考える．
* 環境  
  図4-5(p262)のモデルを用いる．
  衝突が発生すると，時間は離散的なスロットに分割される．
  スロットの長さは，イーサネットの最長往復伝搬時間（$2\tau$）である．
  よって，スロット時間は512ビット時間すなわち\SI{51.2}{\micro s}である．
* 流れ
  1. 衝突が発生すると，局はフレームの送信を中止する
  1. それぞれの局は0または1スロット時間の中から待ち時間をランダムに選択し，待機したあと再送信する
  1. 双方が同じ待ち時間を選択した場合，再び衝突する
  1. それぞれの局は0,1,2,3の中から数値をランダムに選択し，そのスロット時間分待機する